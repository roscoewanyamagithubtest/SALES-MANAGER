<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sales System — All-in-One</title>
  <style>
    body { margin:0; font-family:Arial, sans-serif; background:#f4f6f9; }
    header { background:#2c5364; color:#fff; padding:10px 20px; display:flex; justify-content:space-between; align-items:center; }
    header h1 { margin:0; font-size:20px; }
    #navList { display:flex; gap:10px; list-style:none; padding:0; margin:0; }
    #navList .nav-item { background:#203a43; color:#fff; padding:6px 12px; border-radius:6px; cursor:pointer; }
    #navList .nav-item:hover { background:#1a1f2f; }
    main { padding:20px; }
    table { border-collapse:collapse; width:100%; background:#fff; margin-bottom:15px; }
    th,td { border:1px solid #ccc; padding:8px; text-align:left; }
    th { background:#eee; }
    .btn { padding:4px 8px; border:none; border-radius:4px; cursor:pointer; }
    .btn.small { font-size:12px; padding:2px 6px; }
    .btn-primary { background:#2c5364; color:#fff; }
    .btn-danger { background:#b91c1c; color:#fff; }
    .btn-secondary { background:#334155; color:#fff; }
    .muted { color:#6b7280; font-size:0.9em; }
    .modal { display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.6); justify-content:center; align-items:center; }
    .modal-content { background:#fff; padding:20px; border-radius:8px; width:400px; max-width:90%; }
    #systemStatus { font-size:14px; }
  </style>
</head>
<body>
<header>
  <h1>Sales System</h1>
  <ul id="navList">
    <li class="nav-item" data-view="sales">Sales</li>
    <li class="nav-item" data-view="inventory">Inventory</li>
    <li class="nav-item" data-view="expenses">Expenses</li>
    <li class="nav-item" data-view="employees">Employees</li>
    <li class="nav-item" data-view="suppliers">Suppliers</li>
    <li class="nav-item" data-view="deposits">Deposits</li>
    <li class="nav-item" data-view="records">Records</li>
    <li class="nav-item" data-view="settings">Settings</li>
  </ul>
  <div>
    <span id="currentUserDisplay">Not signed in</span> — <span id="systemStatus">Offline</span>
  </div>
</header>

<main>
  <!-- ================= PAGES ================= -->
  <section id="salesPage" class="page"></section>
  <section id="inventoryPage" class="page" style="display:none"></section>
  <section id="expensesPage" class="page" style="display:none">
    <h2>Expenses</h2>
    <button class="btn btn-primary" onclick="openExpenseModal()">+ Add Expense</button>
    <table id="expensesTable"><thead><tr><th>Date</th><th>Category</th><th>Description</th><th>Amount</th><th>Paid By</th><th>Notes</th><th>Action</th></tr></thead><tbody></tbody></table>
    <div id="expenseTotal"></div>
  </section>
  <section id="employeesPage" class="page" style="display:none">
    <h2>Employees</h2>
    <button class="btn btn-primary" onclick="openEmployeeModal()">+ Add Employee</button>
    <table id="employeesTable"><thead><tr><th>Name</th><th>Position</th><th>Email</th><th>Phone</th><th>Action</th></tr></thead><tbody></tbody></table>
  </section>
  <section id="suppliersPage" class="page" style="display:none">
    <h2>Suppliers</h2>
    <button class="btn btn-primary" onclick="openSupplierModal()">+ Add Supplier</button>
    <table id="suppliersTable"><thead><tr><th>Name</th><th>Contact</th><th>Email</th><th>Action</th></tr></thead><tbody></tbody></table>
  </section>
  <section id="depositsPage" class="page" style="display:none">
    <h2>Deposits</h2>
    <button class="btn btn-primary" onclick="openDepositModal()">+ Add Deposit</button>
    <table id="depositsTable"><thead><tr><th>Date</th><th>Client</th><th>Amount</th><th>Balance</th><th>Action</th></tr></thead><tbody></tbody></table>
  </section>
  <section id="recordsPage" class="page" style="display:none">
    <h2>Records</h2>
    <table id="recordsTable"><thead><tr><th>Type</th><th>Date</th><th>Ref</th><th>Details</th><th>Amount/Qty</th><th>Action</th></tr></thead><tbody></tbody></table>
    <div id="recordsSummary"></div>
    <div id="recordsPagerInfo"></div>
  </section>
  <section id="settingsPage" class="page" style="display:none">
    <h2>Settings</h2>
    <div id="settingsAdminArea"></div>
    <h3>Company Info</h3>
    <form id="companyForm">
      <label>Name <input id="companyName"></label><br>
      <label>Location <input id="companyLocation"></label><br>
      <label>P.O. Box <input id="companyBox"></label><br>
      <label>Tel <input id="companyTel"></label><br>
      <label>Email <input id="companyEmail"></label><br>
      <button class="btn btn-primary" type="submit">Save Company Info</button>
    </form>
  </section>
</main>

<!-- ============= MODALS (expenses, employees, suppliers, deposits, users, login) ============= -->
<div id="expenseModal" class="modal"><div class="modal-content"><form id="expenseForm">
  <input type="date" id="expenseDate" required><br>
  <input type="text" id="expenseCategory" placeholder="Category" required><br>
  <input type="text" id="expenseDesc" placeholder="Description" required><br>
  <input type="number" id="expenseAmount" placeholder="Amount" required><br>
  <button type="submit" class="btn btn-primary">Save</button>
  <button type="button" onclick="closeExpenseModal()">Cancel</button>
</form></div></div>

<div id="employeeModal" class="modal"><div class="modal-content"><form id="employeeForm">
  <input type="hidden" id="employeeId">
  <input type="text" id="employeeName" placeholder="Name" required><br>
  <input type="text" id="employeePosition" placeholder="Position" required><br>
  <input type="email" id="employeeEmail" placeholder="Email"><br>
  <input type="text" id="employeePhone" placeholder="Phone"><br>
  <button type="submit" class="btn btn-primary">Save</button>
  <button type="button" onclick="closeEmployeeModal()">Cancel</button>
</form></div></div>

<div id="supplierModal" class="modal"><div class="modal-content"><form id="supplierForm">
  <input type="hidden" id="supplierId">
  <input type="text" id="supplierName" placeholder="Name" required><br>
  <input type="text" id="supplierContact" placeholder="Contact"><br>
  <input type="email" id="supplierEmail" placeholder="Email"><br>
  <button type="submit" class="btn btn-primary">Save</button>
  <button type="button" onclick="closeSupplierModal()">Cancel</button>
</form></div></div>

<div id="depositModal" class="modal"><div class="modal-content"><form id="depositForm">
  <input type="hidden" id="depositId">
  <input type="date" id="depositDate" required><br>
  <input type="text" id="depositClient" placeholder="Client" required><br>
  <input type="number" id="depositAmount" placeholder="Amount" required><br>
  <input type="number" id="depositBalance" placeholder="Balance"><br>
  <button type="submit" class="btn btn-primary">Save</button>
  <button type="button" onclick="closeDepositModal()">Cancel</button>
</form></div></div>

<div id="loginModal" class="modal"><div class="modal-content"><form id="loginForm">
  <input type="text" id="loginUser" placeholder="Username" required><br>
  <input type="password" id="loginPass" placeholder="Password" required><br>
  <button type="submit" class="btn btn-primary">Login</button>
</form></div></div>

<script>
/* ===========================
   STORAGE & STATE
   =========================== */
const STORAGE_KEY = "sales_system_v3";
const fmt = n => "UGX " + Number(n||0).toLocaleString();
const idf = () => Math.random().toString(36).substr(2,9);

let state = JSON.parse(localStorage.getItem(STORAGE_KEY)||'{}');
if(!state.sales) state.sales=[];
if(!state.inventory) state.inventory=[];
if(!state.expenses) state.expenses=[];
if(!state.employees) state.employees=[];
if(!state.suppliers) state.suppliers=[];
if(!state.deposits) state.deposits=[];
if(!state.users) state.users=[{id:idf(),username:"admin",password:"admin",role:"admin",canViewRecords:true,canCreateSales:true}];
if(!state.company) state.company={name:"",location:"",box:"",tel:"",email:""};

function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }
function currentUser(){ return state.users.find(u=>u.id===sessionStorage.currentUser)||null; }

/* ===========================
   COMPANY INFO
   =========================== */
document.getElementById("companyForm").addEventListener("submit", e=>{
  e.preventDefault();
  state.company={
    name:document.getElementById("companyName").value,
    location:document.getElementById("companyLocation").value,
    box:document.getElementById("companyBox").value,
    tel:document.getElementById("companyTel").value,
    email:document.getElementById("companyEmail").value
  };
  save();
  alert("Company info saved.");
});

/* ===========================
   RECEIPT HEADER
   =========================== */
function companyHeaderHTML(){
  const c = state.company;
  return `<div style="text-align:center">
    <h2>${c.name||''}</h2>
    <div>${c.location||''} ${c.box?('P.O. Box '+c.box):''}</div>
    <div>Tel: ${c.tel||''} Email: ${c.email||''}</div>
    <hr>
  </div>`;
}

/* ===========================
   AUTH
   =========================== */
document.getElementById("loginForm").addEventListener("submit", e=>{
  e.preventDefault();
  const u = state.users.find(u=>u.username===loginUser.value && u.password===loginPass.value);
  if(!u) return alert("Invalid credentials");
  sessionStorage.currentUser = u.id;
  updateUIForAuth();
  closeModal("loginModal");
});

function showLogin(){ document.getElementById("loginModal").style.display="flex"; }
function hideLogin(){ document.getElementById("loginModal").style.display="none"; }

/* ===========================
   NAVIGATION
   =========================== */
document.querySelectorAll("#navList .nav-item").forEach(nav=>{
  nav.onclick=()=>{
    document.querySelectorAll(".page").forEach(p=>p.style.display="none");
    document.getElementById(nav.dataset.view+"Page").style.display="block";
  };
});

/* ===========================
   EXPENSES (with admin check)
   =========================== */
function renderExpenses(){ const tbody=document.querySelector('#expensesTable tbody'); tbody.innerHTML='';
  let total=0;
  state.expenses.forEach(e=>{
    total+=Number(e.amount);
    const tr=document.createElement('tr');
    let deleteBtn='';
    if(currentUser()?.role==="admin"){ deleteBtn=`<button class="btn btn-danger" onclick="deleteExpense('${e.id}')">Delete</button>`; }
    tr.innerHTML=`<td>${e.date}</td><td>${e.category}</td><td>${e.description}</td><td>${fmt(e.amount)}</td><td>${e.paidBy||''}</td><td>${e.notes||''}</td><td>${deleteBtn}</td>`;
    tbody.appendChild(tr);
  });
  document.getElementById('expenseTotal').innerText='Total: '+fmt(total);
}
function openExpenseModal(){openModal("expenseModal");}
function closeExpenseModal(){closeModal("expenseModal");}
document.getElementById("expenseForm").addEventListener("submit", e=>{
  e.preventDefault();
  const exp={id:idf(),date:expenseDate.value,category:expenseCategory.value,description:expenseDesc.value,amount:Number(expenseAmount.value)};
  state.expenses.push(exp); save(); renderExpenses(); closeExpenseModal();
});
function deleteExpense(id){ if(!confirm("Delete this expense?"))return; state.expenses=state.expenses.filter(e=>e.id!==id); save(); renderExpenses(); }

/* ===========================
   EMPLOYEES (admin only edit/delete)
   =========================== */
function renderEmployees(){ const tbody=document.querySelector('#employeesTable tbody'); tbody.innerHTML='';
  state.employees.forEach(e=>{
    const tr=document.createElement('tr');
    let actions='';
    if(currentUser()?.role==="admin"){
      actions=`<button class="btn btn-primary" onclick="editEmployee('${e.id}')">Edit</button>
               <button class="btn btn-danger" onclick="deleteEmployee('${e.id}')">Delete</button>`;
    }
    tr.innerHTML=`<td>${e.name}</td><td>${e.position}</td><td>${e.email}</td><td>${e.phone}</td><td>${actions}</td>`;
    tbody.appendChild(tr);
  });
}
function openEmployeeModal(){openModal("employeeModal");}
function closeEmployeeModal(){closeModal("employeeModal");}
document.getElementById("employeeForm").addEventListener("submit", e=>{
  e.preventDefault();
  const id=employeeId.value||idf();
  const emp={id,name:employeeName.value,position:employeePosition.value,email:employeeEmail.value,phone:employeePhone.value};
  const idx=state.employees.findIndex(x=>x.id===id);
  if(idx>=0) state.employees[idx]=emp; else state.employees.push(emp);
  save(); renderEmployees(); closeEmployeeModal();
});
function editEmployee(id){ const e=state.employees.find(x=>x.id===id); if(!e)return; employeeId.value=e.id; employeeName.value=e.name; employeePosition.value=e.position; employeeEmail.value=e.email; employeePhone.value=e.phone; openModal("employeeModal"); }
function deleteEmployee(id){ if(!confirm("Delete employee?"))return; state.employees=state.employees.filter(x=>x.id!==id); save(); renderEmployees(); }

/* ===========================
   SUPPLIERS (admin only edit/delete)
   =========================== */
function renderSuppliers(){ const tbody=document.querySelector('#suppliersTable tbody'); tbody.innerHTML='';
  state.suppliers.forEach(s=>{
    const tr=document.createElement('tr');
    let actions='';
    if(currentUser()?.role==="admin"){
      actions=`<button class="btn btn-primary" onclick="editSupplier('${s.id}')">Edit</button>
               <button class="btn btn-danger" onclick="deleteSupplier('${s.id}')">Delete</button>`;
    }
    tr.innerHTML=`<td>${s.name}</td><td>${s.contact}</td><td>${s.email}</td><td>${actions}</td>`;
    tbody.appendChild(tr);
  });
}
function openSupplierModal(){openModal("supplierModal");}
function closeSupplierModal(){closeModal("supplierModal");}
document.getElementById("supplierForm").addEventListener("submit", e=>{
  e.preventDefault();
  const id=supplierId.value||idf();
  const sup={id,name:supplierName.value,contact:supplierContact.value,email:supplierEmail.value};
  const idx=state.suppliers.findIndex(x=>x.id===id);
  if(idx>=0) state.suppliers[idx]=sup; else state.suppliers.push(sup);
  save(); renderSuppliers(); closeSupplierModal();
});
function editSupplier(id){const s=state.suppliers.find(x=>x.id===id); if(!s)return; supplierId.value=s.id; supplierName.value=s.name; supplierContact.value=s.contact; supplierEmail.value=s.email; openModal("supplierModal");}
function deleteSupplier(id){ if(!confirm("Delete supplier?"))return; state.suppliers=state.suppliers.filter(x=>x.id!==id); save(); renderSuppliers(); }

/* ===========================
   DEPOSITS
   =========================== */
function renderDeposits(){ const tbody=document.querySelector('#depositsTable tbody'); tbody.innerHTML='';
  state.deposits.forEach(d=>{
    let delBtn=currentUser()?.role==="admin"?`<button class="btn btn-danger" onclick="deleteDeposit('${d.id}')">Delete</button>`:'';
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${d.date}</td><td>${d.client}</td><td>${fmt(d.amount)}</td><td>${fmt(d.balance||0)}</td><td>${delBtn}</td>`;
    tbody.appendChild(tr);
  });
}
function openDepositModal(){openModal("depositModal");}
function closeDepositModal(){closeModal("depositModal");}
document.getElementById("depositForm").addEventListener("submit", e=>{
  e.preventDefault();
  const dep={id:depositId.value||idf(),date:depositDate.value,client:depositClient.value,amount:Number(depositAmount.value),balance:Number(depositBalance.value||0)};
  const idx=state.deposits.findIndex(x=>x.id===dep.id);
  if(idx>=0) state.deposits[idx]=dep; else state.deposits.push(dep);
  save(); renderDeposits(); closeDepositModal();
});
function deleteDeposit(id){ if(!confirm("Delete deposit?"))return; state.deposits=state.deposits.filter(d=>d.id!==id); save(); renderDeposits(); }

/* ===========================
   UTIL
   =========================== */
function openModal(id){ document.getElementById(id).style.display="flex"; }
function closeModal(id){ document.getElementById(id).style.display="none"; }
function updateUIForAuth(){
  const u=currentUser();
  document.getElementById("currentUserDisplay").innerText=u?u.username+" ("+u.role+")":"Not signed in";
  document.getElementById("systemStatus").innerText=u?"Online":"Offline";
  renderExpenses(); renderEmployees(); renderSuppliers(); renderDeposits();
}
updateUIForAuth();
showLogin();
</script>
</body>
</html>
